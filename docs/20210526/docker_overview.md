# Docker 概览

Docker 是一个开放的平台，用于开发，分发和运行程序。Docker 允许你的应用程序和你的基础设施分离，所以你可以快速的交付你软件。使用 Docker, 你可以像管理你的应用程序一样管理基础设施。通过利用 Docker 的方法论来，你可以快速的分发，测试和交付你的代码，你可以显著的减少编写代码和运行代码在生产环境之间的延迟。

## Docker 平台
Docker 提供了打包和运行一个应用程序在松耦合的环境(容器)的能力。容器提供的隔离性和安全性允许多个容器同时在主机上运行。容器是轻量级的，同时包含了一个运行程序所需要的一切，所以你不需要依赖当前应用程序安装的主机。你可以简单地分享你的容器当你正在工作的时候，并且可以保证获得分享容器的每个人获得相同的容器，并且能够以相同的方式工作。

Docker 为容器提供用于管理容器声明周期的工具和平台：
1. 使用容器开发你的应用程序以及应用程序支持的组件
2. 容器称为分发和测试你应用程序的单元
3. 当你准备好了，分发你的应用程序到生产环境中，作为一个容器或者一个编排服务。应用程序会以相同的方式工作，无论你的生产环境是在本地数据中心还是云上，亦或者是两者的混合。

## 可以用Docker来做什么？
1. **快速，持续交付你的应用程序**
Docker 通过允许开发者使用本地容器提供的应用程序或者服务以标准化的方式工作来简化了开发周期。容器非常有利于持续集成和持续发布的工作流。

考虑一下的案例：
1. 你的开发者在本地编写代码，然后使用 Docker 容器和同事共享他的工作。

2. 使用 Docker 来发布他的应用程序到测试环境来执行自动/手动的测试

3. 当开发者发现 bug, 他们开发在开发环境中修复他们，然后重新发布程序到测试环境来测试和验证。

4. 当测试完成了，给客户提供修复包变得和发布一个更新的更新到生产环境一样简单

2. **响应式的部署和扩展**
Docker 的基于容器的平台允许高度便捷的工作负载。Docker 的容器可以运行在开发者自己的笔记本，数据中心的物理机或者虚拟机，云上，或者这些环境的混合模式。

Docker 的便携式和轻量级特性运行它简单的动态管理工作负载，可以根据业务需求接近实时的进行放大或缩小应用程序。

3. **在相同硬件上运行更多的工作负载**
Docker 是轻量级和快速的。它提供一个可行的，具有成本效益的替代基于虚拟化的虚拟主机的替代方案，所以你可以更多的使用你电脑的计算能力来取得商业目标。Docker 非常适用于高密集环境和中小型部署，同时你只需要很少的资源，就能做很多的事情。

## Docker 的架构
Docker 使用基于 client-server 的架构模式。Dokcer 的客户端和 Docker 的守护进程进行通信。Docker 的守护进程做了很多工作，如构建，运行和分发你的 Docker 容器。Docker 的客户端和守护进程可以运行在同一个系统上，或者你可以使用客户端连接远程Docker 守护进程。Docker 的客户端和守护进程使用 REST API进程通信，基于 UNIX sockets 或者 网络接口。另外一个Docker 的客户端是 Docker Compose, 可以让你在由一系列容器组成的应用上工作。
![Docker 架构](https://github.com/jackzhiii/JackZhiii/blob/main/images/docker_architecture.svg)

## Docker 守护进程
Docker 守护进程(dockerd) 用于监听 Docker API 的请求并且管理 Dokcer 的对象，例如，镜像，容器，网络和存储卷。守护进程同样可以和其他守护进程进行通信来管理 Docker 的服务。

## Docker 的客户端
Docker 客户端（docker）是用户和 Docker 交互的主要工具。当你使用命令，例如 docker run, 客户端发送命令到 dockerd, 服务端执行该命令。docker 命令使用 Docker API。Docker 客户端可以和不止一个守护进程进行通信。

## Docker 仓库
Docker 仓库存储 Docker images。Docker Hub 是主要的仓库任何人可以使用，并且Docker 服务器被配置为默认使用 Docker Hub作为仓库。你也可以部署自己的私人仓库。

当你使用 docker pull 或者 docker run 命令，被要求获取的镜像从被你配置的仓库地址获取。当你使用 docker push 命令，你的镜像将会推送到你配置的仓库。

## Docker 对象
当你使用 Docker, 你创建和使用 images, containers, networks, volumns, plugins, 以及其他对象。这部分将会简要的介绍这些对象。

### Images
一个镜像是携带指令的只读模版，用于创建 Docker 容器。通常的，一个镜像基于另外一个镜像，只是携带了额外信息的定制化版本。举个例子，你可能构建了一个基于 ubuntu 镜像的镜像，但是安装了 Apache 服务器和你的应用程序，同样包含用于让你应用程序运行的配置细节。

你可能创建了你自己的镜像或者你可能别人创建并发布到仓库的镜像。为了构建你自己的镜像，你可以通过简单的语法创建 Dockerfile文件用于定义如何创建和运行镜像。在 Dockerfile 中没一个指令都是一层。当你改变了 Dockerfile 并且重新构建镜像，仅仅那些被改变的成需要重新构建。当和其他虚拟技术相比较而言，这就是为什么制作镜像如此轻量，小巧，快速的一部分原因。

### Containers
一个容器是镜像的运行实例。你可以使用 Docker API 或者 CLI 来创建，启动，停止，移动或者删除。你可以将容器连接到一个或多个网络，给它附加存储，甚至基于可以基于当前容器当前的状态创建一个新的镜像。

默认的，一个容器和其他容器或者主机之间有相对较好的隔离性。你可以控制容器的网络，存储或其他基础子系统与其他容器或者主机之间的隔离程度。

一个容器由它启动的镜像以及任何你启动容器时候配置的可选参数定义。当你一个容器被移除的时候，该容器任何状态的改变都不会恢复当对应的持久存储不存在。

### 例子 docker run 命令
一下的命令运行了 ubuntu 容器，附加了可交互性到你的本地命令行会话，然后运行 /bin/bash

```bash
docker run -i -t ubuntu /bin/bash
```

当你运行这个命令，其实发生以下行为（假设你使用默认的仓库配置）
1. 如果你本地还没有 ubuntu 镜像, 那么 Docker 首先会从你配置的仓库下载该镜像，就好像你已经手动运行了 docker pull ubuntu

2. Docker 创建了镜像，就好像你已经手动执行了 docker container create 命令

3. Docker 为容器分配了 读写文件系统，作为该容器的最上层。这允许一个正在运行的容器在它自己的文件系统中创建或者修改文件或者目录

4. Docker 创建了网络接口用于容器和默认的网络进行连接，因为你没有定义任何网络参数。同样的，这包括会为容器分配一个 IP 地址。默认的，容器可以通过使用宿主机的网络和外部的网络进行连接。

5. Docker 启动容器然后执行 /bin/bash. 因为容器正运行在交互，附加在你的终端上（由于 -i 和 -t 参数）, 所以你能够所用你的键盘作为输入同时输出被记录在你的终端上。

6. 当你在终端上执行 exit 命令，该容器就会被停止，但是不会被删除。你可以选择再次启动该容器或者直接删除该容器。

## 容器底层技术
Docker 是使用 Go 语言编写的，并且利用了 Linux 内核一系列特性来实现它的功能。Docker 使用的技术被称为 namespace 来提供隔离的工作区间被称为 容器。当你运行一个容器，Docker 为该容器创建一些列 namespaces

这些 namespaces 提供了一层隔离。容器的每个方面运行在单独的隔离 namespace 并且和其他 namespace 之间访问被限制。
